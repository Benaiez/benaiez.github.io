<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Portafolio de Benaiez - Game Developer">
    <link rel="icon" href="icon.png" type="image/png">
    <title>Benaiez | Game Developer</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Rajdhani:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --primary: #ffcc00;
            --accent: #00e5ff;
            --danger: #ff0055;
            --success: #00ff66;
            --dark-bg: #0a0a0a;
            --glass-bg: rgba(20, 20, 20, 0.85); 
            --glass-border: rgba(255, 204, 0, 0.2);
            --font-pixel: 'Press Start 2P', cursive;
            --font-tech: 'Rajdhani', sans-serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        html { scroll-behavior: smooth; }
        body {
            background-color: var(--dark-bg);
            color: #fff;
            font-family: var(--font-tech);
            overflow-x: hidden;
            min-height: 100vh;
            cursor: default;
        }
        
        body.game-active { overflow: hidden; touch-action: none; }

        /* --- CANVAS --- */
        #particle-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -2; background: radial-gradient(circle at center, #1a1a1a 0%, #000 100%); }
        #game-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 10; pointer-events: none; opacity: 0; transition: opacity 0.5s; }
        body.game-active #game-canvas { pointer-events: all; opacity: 1; cursor: crosshair; }

        /* --- UI JUEGO --- */
        #damage-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 15;
            box-shadow: inset 0 0 0 0 transparent; transition: box-shadow 0.2s;
        }

        .notification-toast {
            position: fixed; top: 25%; left: 50%; transform: translate(-50%, -50%);
            font-family: var(--font-pixel); font-size: 1.2rem; width: 100%;
            text-align: center; pointer-events: none; opacity: 0; z-index: 25;
            transition: opacity 0.3s, transform 0.3s;
        }
        .notification-toast.active { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
        
        #powerup-msg { color: var(--accent); text-shadow: 0 0 20px var(--accent); }
        #heal-msg { color: var(--success); text-shadow: 0 0 20px var(--success); top: 20%; }

        #game-ui {
            position: fixed; top: 20px; left: 20px; font-family: var(--font-pixel); color: #fff; z-index: 20;
            display: none; text-align: left; pointer-events: none;
        }
        body.game-active #game-ui { display: block; }
        
        .hud-row { margin-bottom: 15px; font-size: 1.1rem; text-shadow: 2px 2px 0 #000; }
        .hud-score { color: var(--primary); }
        .hud-health { color: var(--accent); transition: color 0.3s; }
        .hud-health.low { color: var(--danger); animation: blink 0.5s infinite; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

        /* Bot贸n Abortar Misi贸n - Z-Index MUY alto para asegurar clic */
        #ingame-exit-btn {
            position: fixed; top: 20px; right: 20px; z-index: 9999;
            background: rgba(255, 0, 85, 0.2); border: 1px solid var(--danger);
            color: #fff; padding: 10px 20px; cursor: pointer;
            font-family: var(--font-pixel); font-size: 0.8rem;
            display: none; transition: 0.3s; pointer-events: auto !important;
        }
        #ingame-exit-btn:hover { background: var(--danger); }
        body.game-active #ingame-exit-btn { display: block; }

        .game-over-screen {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            text-align: center; display: none; z-index: 30; width: 90%;
        }
        body.game-over .game-over-screen { display: block; }
        .game-over-title { font-size: 2.5rem; color: var(--danger); margin-bottom: 20px; text-shadow: 4px 4px 0 #000; }
        
        /* Botones de men煤 final - Z-Index alto */
        .restart-btn {
            background: #fff; color: #000; padding: 15px 30px; border: none; font-family: var(--font-pixel);
            cursor: pointer; font-size: 1rem; margin-top: 20px; transition: 0.3s; pointer-events: auto !important; position: relative; z-index: 9999;
        }
        .restart-btn:hover { background: var(--primary); transform: scale(1.1); }

        /* --- JOYSTICKS MVIL --- */
        #mobile-controls {
            position: fixed; bottom: 20px; left: 0; width: 100%; height: 150px;
            z-index: 22; display: none; pointer-events: none;
        }
        body.game-active.is-mobile #mobile-controls { display: flex; justify-content: space-between; padding: 0 40px; }
        
        .joystick-zone {
            width: 120px; height: 120px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            position: relative;
            pointer-events: auto; /* Permitir toque */
        }
        .joystick-knob {
            width: 50px; height: 50px;
            background: rgba(255, 204, 0, 0.5);
            border-radius: 50%;
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 10px var(--primary);
        }
        .joystick-label {
            position: absolute; bottom: -25px; left: 50%; transform: translateX(-50%);
            font-family: var(--font-tech); font-size: 0.8rem; color: #aaa; opacity: 0.7;
        }

        /* --- PANTALLA ROTAR DISPOSITIVO --- */
        #rotate-warning {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 10000;
            display: none; flex-direction: column; justify-content: center; align-items: center;
            color: #fff; text-align: center; padding: 20px;
        }
        #rotate-warning i { font-size: 4rem; color: var(--primary); margin-bottom: 20px; animation: rotate-icon 2s infinite ease-in-out; }
        @keyframes rotate-icon { 0% { transform: rotate(0deg); } 25% { transform: rotate(-90deg); } 100% { transform: rotate(-90deg); } }

        /* Solo mostrar advertencia si: es m贸vil, est谩 el juego activo, y est谩 en vertical */
        @media (orientation: portrait) and (max-width: 768px) {
            body.game-active #rotate-warning { display: flex; }
            body.game-active #game-canvas, 
            body.game-active #game-ui, 
            body.game-active #mobile-controls,
            body.game-active #ingame-exit-btn { display: none !important; }
        }

        @media (pointer: fine) { #mobile-controls { display: none !important; } }

        /* --- HEADER & HERO --- */
        header {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 1000px; padding: 15px 40px;
            background: rgba(10, 10, 10, 0.9); backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border); border-radius: 50px;
            display: flex; justify-content: space-between; align-items: center;
            z-index: 100; transition: transform 0.3s;
        }
        body.game-active header { transform: translate(-50%, -200%); }

        header h1 { font-family: var(--font-pixel); font-size: 1.5rem; color: var(--primary); text-shadow: 2px 2px 0 #000; }
        nav { display: flex; gap: 10px; }
        nav a {
            color: #fff; text-decoration: none; padding: 8px 16px; border-radius: 20px;
            font-weight: 600; font-size: 0.9rem; transition: 0.3s; font-family: var(--font-tech);
        }
        nav a:hover { color: #000; background: var(--primary); box-shadow: 0 0 20px var(--primary); }

        .hero {
            position: relative; min-height: 100vh;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            text-align: center; padding: 20px; transition: opacity 0.5s;
        }
        body.game-active .hero-content { opacity: 0; pointer-events: none; }

        .hero h2 { font-family: var(--font-pixel); font-size: 3rem; margin-bottom: 50px; line-height: 1.4; }
        .hero span { color: var(--primary); }
        
        .start-game-ui { display: block; }
        .start-game-btn {
            padding: 15px 40px; background: transparent; border: 2px solid var(--primary);
            color: var(--primary); font-family: var(--font-pixel); font-size: 1rem;
            cursor: pointer; position: relative; overflow: hidden; transition: 0.3s;
            text-transform: uppercase; letter-spacing: 2px;
            box-shadow: 0 0 15px rgba(255, 204, 0, 0.2); animation: pulse-btn 2s infinite;
        }
        .start-game-btn:hover { background: var(--primary); color: #000; box-shadow: 0 0 40px var(--primary); }
        @keyframes pulse-btn { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

        /* --- SECTIONS --- */
        section { scroll-margin-top: 120px; }
        .section-container { max-width: 1200px; margin: 0 auto; min-height: auto; padding: 60px 20px; display: flex; flex-direction: column; justify-content: center; margin-bottom: 20px; }
        .section-title { font-family: var(--font-pixel); font-size: 2rem; margin-bottom: 40px; text-align: center; text-shadow: 4px 4px 0 #000; }
        
        .projects { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 40px; width: 100%; }
        
        .project-card { background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 16px; padding: 20px; transition: all 0.4s ease; display: flex; flex-direction: column; height: 100%; position: relative; overflow: hidden; }
        .project-card:hover { transform: translateY(-10px) scale(1.02); border-color: var(--primary); box-shadow: 0 0 30px rgba(255, 204, 0, 0.2); }
        
        .img-wrapper { width: 100%; aspect-ratio: 16/9; border-radius: 10px; overflow: hidden; margin-bottom: 20px; background: #000; position: relative; }
        .project-card img.static-img { width: 100%; height: 100%; object-fit: cover; position: absolute; top: 0; left: 0; z-index: 1; }
        .project-card img.gif-overlay { width: 100%; height: 100%; object-fit: cover; position: absolute; top: 0; left: 0; z-index: 2; opacity: 0; transition: opacity 0.2s ease-in-out; }
        .project-card:hover img.gif-overlay { opacity: 1; }

        .card-content { flex-grow: 1; display: flex; flex-direction: column; }
        .project-card h3 { font-family: var(--font-pixel); font-size: 1.1rem; color: var(--primary); margin-bottom: 12px; }
        .project-card p { margin-bottom: 45px; line-height: 1.6; color: #ddd; }
        .buttons-container { margin-top: auto; display: flex; justify-content: center; gap: 15px; }
        .btn-icon { width: 45px; height: 45px; display: flex; align-items: center; justify-content: center; background: #222; border-radius: 50%; color: #fff; font-size: 1.2rem; transition: 0.3s; border: 1px solid #333; }
        .btn-icon:hover { background: var(--primary); color: #000; box-shadow: 0 0 15px var(--primary); transform: rotate(360deg); }

        .glass-box { background: linear-gradient(135deg, rgba(30,30,30,0.6), rgba(30,30,30,0.3)); backdrop-filter: blur(10px); border: 1px solid var(--glass-border); padding: 50px; border-radius: 20px; text-align: center; max-width: 800px; width: 100%; margin: 0 auto; position: relative; }
        .glass-box::before { content: ''; position: absolute; top: 0; left: 0; width: 4px; height: 100%; background: var(--primary); }

        .social-grid { display: flex; justify-content: center; gap: 25px; flex-wrap: wrap; margin-top: 35px; }
        .social-item { font-size: 2.2rem; color: #777; transition: 0.3s; }
        .social-item:hover { color: var(--primary); transform: scale(1.2) rotate(10deg); }
        .social-item img { width: 35px; filter: grayscale(100%); transition: 0.3s; }
        .social-item:hover img { filter: none; }

        footer { padding: 40px; text-align: center; font-size: 0.8rem; color: #555; background: #000; border-top: 1px solid #1a1a1a; margin-top: 20px; }
        .fade-section { opacity: 0; transform: translateY(50px); transition: all 0.8s ease; }
        .fade-section.visible { opacity: 1; transform: translateY(0); }

        @media (max-width: 768px) {
            header { width: 95%; top: 15px; padding: 12px 20px; }
            header h1 { font-size: 1.2rem; }
            .hero h2 { font-size: 1.8rem; margin-bottom: 30px; }
            .section-container { padding: 40px 20px; margin-bottom: 0px; }
            section { scroll-margin-top: 100px; }
            #game-canvas { width: 100%; height: 100%; }
        }
    </style>
</head>
<body>

    <div id="rotate-warning">
        <i class="fas fa-mobile-alt"></i>
        <h2>PLEASE ROTATE DEVICE</h2>
        <p>This game requires landscape mode.</p>
    </div>

    <canvas id="particle-canvas"></canvas>
    <canvas id="game-canvas"></canvas>
    <div id="damage-overlay"></div>
    
    <div id="powerup-msg" class="notification-toast">TRI-BLASTER!</div>
    <div id="heal-msg" class="notification-toast">MAX HEALTH RESTORED!</div>

    <button id="ingame-exit-btn" onclick="exitGame()">ABORT MISSION</button>

    <div id="game-ui">
        <div class="hud-row hud-score">SCORE: <span id="score-val">0</span></div>
        <div class="hud-row hud-health">HP: <span id="hp-val">100</span>%</div>
    </div>

    <div id="mobile-controls">
        <div class="joystick-zone" id="joy-left">
            <div class="joystick-knob" id="knob-left"></div>
            <div class="joystick-label">MOVE</div>
        </div>
        <div class="joystick-zone" id="joy-right">
            <div class="joystick-knob" id="knob-right"></div>
            </div>
    </div>

    <div class="game-over-screen">
        <h2 class="game-over-title">GAME OVER</h2>
        <p style="font-family: var(--font-tech); font-size: 1.5rem; margin-bottom: 20px;">FINAL SCORE: <span id="final-score">0</span></p>
        <button class="restart-btn" onclick="resetGame()">TRY AGAIN</button>
        <button class="restart-btn" onclick="exitGame()" style="background:transparent; color:#fff; border:1px solid #fff; margin-left:10px;">EXIT</button>
    </div>

    <header>
        <h1>Benaiez</h1>
        <nav>
            <a href="#games">GAMES</a>
            <a href="#about">ABOUT</a>
            <a href="#contact">CONTACT</a>
        </nav>
    </header>

    <section class="hero">
        <div class="hero-content">
            <h2>Welcome,<br><span>Thanks for visiting</span></h2>
            <div class="start-game-ui">
                <button class="start-game-btn" onclick="startGame()">
                    <i class="fas fa-gamepad"></i> START MISSION
                </button>
                <p style="font-size: 0.8rem; margin-top: 15px; opacity: 0.6;" id="controls-hint">[WASD to Move] [Hold Click to Shoot]</p>
            </div>
        </div>
    </section>

    <main>
        <section id="games" class="section-container fade-section">
            <h2 class="section-title">PROJECTS</h2>
            <div class="projects">
                <article class="project-card" data-gif="gifspeed.gif">
                    <div class="img-wrapper"><img class="static-img" src="speedcoinsbanner.png" alt="SpeedCoins"></div>
                    <div class="card-content">
                        <h3>SpeedCoins</h3>
                        <p>A 2D platformer where time is your enemy. Collect coins, dodge traps, survive.</p>
                        <div class="buttons-container">
                            <a href="https://benaiez.itch.io/speedcoins" class="btn-icon" target="_blank"><i class="fab fa-itch-io"></i></a>
                            <a href="https://store.steampowered.com/app/3685060/SpeedCoins/" class="btn-icon" target="_blank"><i class="fab fa-steam"></i></a>
                        </div>
                    </div>
                </article>
                <article class="project-card" data-gif="roadcube.gif">
                    <div class="img-wrapper"><img class="static-img" src="roadcube.png" alt="RoadCube"></div>
                    <div class="card-content">
                        <h3>RoadCube</h3>
                        <p>Logic and precision. Take the cubes back to their rightful place.</p>
                        <div class="buttons-container">
                            <a href="https://benaiez.itch.io/roadcube" class="btn-icon" target="_blank"><i class="fab fa-itch-io"></i></a>
                        </div>
                    </div>
                </article>
                <article class="project-card" data-gif="badfame.gif">
                    <div class="img-wrapper"><img class="static-img" src="badfamebanner.png" alt="BadFame"></div>
                    <div class="card-content">
                        <h3>BadFame</h3>
                        <p>Action packed chaos. Avoid being crushed by your own overwhelming fans!</p>
                        <div class="buttons-container">
                            <a href="https://benaiez.itch.io/badfame" class="btn-icon" target="_blank"><i class="fab fa-itch-io"></i></a>
                        </div>
                    </div>
                </article>
            </div>
        </section>

        <section id="about" class="section-container fade-section">
            <h2 class="section-title">ABOUT ME</h2>
            <div class="glass-box">
                <p>Hi! I'm <strong>Benaiez</strong>, I live in Colombia .</p>
                <br>
                <p>I like to create video games and share them with the world!</p>
            </div>
        </section>

        <section id="contact" class="section-container fade-section">
            <h2 class="section-title">CONNECT</h2>
            <div class="glass-box">
                <div class="social-grid">
                    <a href="https://gamejolt.com/@Benaiez" target="_blank" class="social-item"><img src="https://img.icons8.com/?size=512&id=YTbMMLHYryHA&format=png" alt="GameJolt"></a>
                    <a href="https://www.facebook.com/people/Benaiez/100091622667087/" target="_blank" class="social-item"><i class="fab fa-facebook"></i></a>
                    <a href="https://x.com/Benaiez" target="_blank" class="social-item"><i class="fab fa-twitter"></i></a>
                    <a href="https://instagram.com/benaiez" target="_blank" class="social-item"><i class="fab fa-instagram"></i></a>
                    <a href="https://benaiez.itch.io/" target="_blank" class="social-item"><i class="fab fa-itch-io"></i></a>
                    <a href="https://discord.gg/VthpHWQAfy" target="_blank" class="social-item"><i class="fab fa-discord"></i></a>
                    <a href="https://www.youtube.com/@Benaiez" target="_blank" class="social-item"><i class="fab fa-youtube"></i></a>
                </div>
                <p style="margin-top: 30px;">Email: <a href="mailto:benaiez047@gmail.com" style="color: var(--primary); text-decoration: none;">benaiez047@gmail.com</a></p>
            </div>
        </section>
    </main>

    <footer>
        <p>&copy; 2025 Benaiez.</p>
    </footer>

    <script>
        if ('scrollRestoration' in history) history.scrollRestoration = 'manual';
        window.onload = function() { 
            window.scrollTo(0, 0); 
            document.querySelectorAll('.project-card').forEach(card => {
                const gifUrl = card.dataset.gif;
                const wrapper = card.querySelector('.img-wrapper');
                if (gifUrl && wrapper) {
                    const gifImg = document.createElement('img');
                    gifImg.src = gifUrl; gifImg.className = 'gif-overlay'; gifImg.alt = "Gameplay GIF";
                    wrapper.appendChild(gifImg);
                }
            });
            const isTouch = (('ontouchstart' in window) || (navigator.maxTouchPoints > 0));
            const isMobileUA = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            
            if(isTouch && isMobileUA) {
                document.body.classList.add('is-mobile');
                document.getElementById('controls-hint').innerText = "[Use Joysticks to Play]";
            }
        };

        const gameCanvas = document.getElementById('game-canvas');
        const gCtx = gameCanvas.getContext('2d');
        const damageOverlay = document.getElementById('damage-overlay');
        const hpDisplay = document.getElementById('hp-val');
        const powerMsg = document.getElementById('powerup-msg');
        const healMsg = document.getElementById('heal-msg');
        
        let gameLoopId;
        let score = 0;
        let hp = 100;
        let activePowerUpTime = 0;
        
        let player = null;
        let bullets = [];
        let enemies = [];
        let gameParticles = [];
        let powerUps = []; 
        let healthItems = []; 
        
        let mousePos = { x: 0, y: 0 };
        let keys = {};
        let shakeTime = 0;
        let isFiring = false;
        let lastShotTime = 0;
        const FIRE_RATE = 120;

        let joyLeft = { active: false, x: 0, y: 0, originX: 0, originY: 0, touchId: null };
        let joyRight = { active: false, x: 0, y: 0, originX: 0, originY: 0, touchId: null };

        function resizeGame() {
            gameCanvas.width = window.innerWidth;
            gameCanvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resizeGame);
        resizeGame();

        window.addEventListener('mousemove', e => { mousePos.x = e.clientX; mousePos.y = e.clientY; });
        window.addEventListener('mousedown', () => { isFiring = true; });
        window.addEventListener('mouseup', () => { isFiring = false; });
        window.addEventListener('keydown', e => keys[e.code] = true);
        window.addEventListener('keyup', e => keys[e.code] = false);

        // TOUCH INPUT FIX - PERMITIR CLIC EN BOTONES
        const leftZone = document.getElementById('joy-left');
        const rightZone = document.getElementById('joy-right');
        const knobLeft = document.getElementById('knob-left');
        const knobRight = document.getElementById('knob-right');

        function handleTouchStart(e, type) {
            // FIX: Si el usuario toca un bot贸n, NO bloquear el evento
            if(e.target.tagName === 'BUTTON') return;

            e.preventDefault();
            for (let i = 0; i < e.changedTouches.length; i++) {
                const t = e.changedTouches[i];
                if(type === 'left' && !joyLeft.active) {
                    joyLeft.active = true; joyLeft.touchId = t.identifier;
                    const rect = leftZone.getBoundingClientRect();
                    joyLeft.originX = rect.left + rect.width/2;
                    joyLeft.originY = rect.top + rect.height/2;
                    updateJoystick(t, 'left');
                } else if(type === 'right' && !joyRight.active) {
                    joyRight.active = true; joyRight.touchId = t.identifier;
                    const rect = rightZone.getBoundingClientRect();
                    joyRight.originX = rect.left + rect.width/2;
                    joyRight.originY = rect.top + rect.height/2;
                    isFiring = true; 
                    updateJoystick(t, 'right');
                }
            }
        }

        function handleTouchMove(e) {
            // Solo bloquear en el juego
            if(document.body.classList.contains('game-active')) {
                e.preventDefault();
                for (let i = 0; i < e.changedTouches.length; i++) {
                    const t = e.changedTouches[i];
                    if (t.identifier === joyLeft.touchId) updateJoystick(t, 'left');
                    if (t.identifier === joyRight.touchId) updateJoystick(t, 'right');
                }
            }
        }

        function handleTouchEnd(e) {
            if(e.target.tagName === 'BUTTON') return;
            if(document.body.classList.contains('game-active')) {
                e.preventDefault();
                for (let i = 0; i < e.changedTouches.length; i++) {
                    const t = e.changedTouches[i];
                    if (t.identifier === joyLeft.touchId) {
                        joyLeft.active = false; joyLeft.x = 0; joyLeft.y = 0;
                        knobLeft.style.transform = `translate(-50%, -50%)`;
                    }
                    if (t.identifier === joyRight.touchId) {
                        joyRight.active = false; isFiring = false;
                        knobRight.style.transform = `translate(-50%, -50%)`;
                    }
                }
            }
        }

        function updateJoystick(touch, type) {
            const maxDist = 40;
            const joy = type === 'left' ? joyLeft : joyRight;
            const knob = type === 'left' ? knobLeft : knobRight;
            let dx = touch.clientX - joy.originX;
            let dy = touch.clientY - joy.originY;
            const dist = Math.sqrt(dx*dx + dy*dy);
            if(dist > maxDist) { dx = (dx / dist) * maxDist; dy = (dy / dist) * maxDist; }
            joy.x = dx / maxDist; joy.y = dy / maxDist;
            knob.style.transform = `translate(calc(-50% + ${dx}px), calc(-50% + ${dy}px))`;
        }

        leftZone.addEventListener('touchstart', (e) => handleTouchStart(e, 'left'), {passive: false});
        rightZone.addEventListener('touchstart', (e) => handleTouchStart(e, 'right'), {passive: false});
        window.addEventListener('touchmove', handleTouchMove, {passive: false});
        window.addEventListener('touchend', handleTouchEnd, {passive: false});

        class Player {
            constructor() {
                this.x = gameCanvas.width / 2; this.y = gameCanvas.height / 2;
                this.radius = 15; this.angle = 0; this.vel = { x: 0, y: 0 }; this.speed = 5;
            }
            update() {
                let kx = 0, ky = 0;
                if (keys['KeyW'] || keys['ArrowUp']) ky = -1;
                if (keys['KeyS'] || keys['ArrowDown']) ky = 1;
                if (keys['KeyA'] || keys['ArrowLeft']) kx = -1;
                if (keys['KeyD'] || keys['ArrowRight']) kx = 1;

                if(joyLeft.active) { this.vel.x = joyLeft.x * this.speed; this.vel.y = joyLeft.y * this.speed; }
                else { this.vel.x = kx * this.speed; this.vel.y = ky * this.speed; }

                this.x += this.vel.x; this.y += this.vel.y;
                if(this.x < 0) this.x = 0; if(this.x > gameCanvas.width) this.x = gameCanvas.width;
                if(this.y < 0) this.y = 0; if(this.y > gameCanvas.height) this.y = gameCanvas.height;

                if(joyRight.active) { this.angle = Math.atan2(joyRight.y, joyRight.x); }
                else { this.angle = Math.atan2(mousePos.y - this.y, mousePos.x - this.x); }
            }
            draw() {
                gCtx.save(); gCtx.translate(this.x, this.y);
                if(activePowerUpTime > 0) {
                    const pct = activePowerUpTime / 420; 
                    gCtx.fillStyle = '#333'; gCtx.fillRect(-20, 25, 40, 4);
                    gCtx.fillStyle = '#00e5ff'; gCtx.fillRect(-20, 25, 40 * pct, 4);
                }
                gCtx.rotate(this.angle);
                const hasW = activePowerUpTime > 0;
                gCtx.beginPath(); gCtx.moveTo(20, 0); gCtx.lineTo(-15, 15); gCtx.lineTo(-10, 0); gCtx.lineTo(-15, -15); gCtx.closePath();
                gCtx.strokeStyle = '#00e5ff'; gCtx.lineWidth = 2; gCtx.stroke();
                if(hasW) {
                    gCtx.beginPath(); gCtx.moveTo(-10, 10); gCtx.lineTo(-25, 20); gCtx.stroke();
                    gCtx.beginPath(); gCtx.moveTo(-10, -10); gCtx.lineTo(-25, -20); gCtx.stroke();
                }
                if(this.vel.x !== 0 || this.vel.y !== 0) {
                    gCtx.beginPath(); gCtx.moveTo(-15, 0); gCtx.lineTo(-30, 0);
                    gCtx.strokeStyle = hasW ? '#00e5ff' : '#ffcc00'; gCtx.stroke();
                }
                gCtx.restore();
            }
            shoot() {
                if(activePowerUpTime > 0) {
                    bullets.push(new Bullet(this.x, this.y, Math.cos(this.angle), Math.sin(this.angle)));
                    bullets.push(new Bullet(this.x, this.y, Math.cos(this.angle - 0.25), Math.sin(this.angle - 0.25)));
                    bullets.push(new Bullet(this.x, this.y, Math.cos(this.angle + 0.25), Math.sin(this.angle + 0.25)));
                    playSound(900, 'square', 0.1);
                } else {
                    bullets.push(new Bullet(this.x, this.y, Math.cos(this.angle), Math.sin(this.angle)));
                    playSound(800, 'square', 0.1);
                }
            }
        }

        class Bullet {
            constructor(x, y, dx, dy) {
                this.x = x; this.y = y; this.dx = dx; this.dy = dy; this.speed = 10; this.marked = false;
            }
            update() { this.x += this.dx * this.speed; this.y += this.dy * this.speed; if(this.x < 0 || this.x > gameCanvas.width || this.y < 0 || this.y > gameCanvas.height) this.marked = true; }
            draw() { gCtx.beginPath(); gCtx.arc(this.x, this.y, activePowerUpTime > 0 ? 4 : 3, 0, Math.PI*2); gCtx.fillStyle = activePowerUpTime > 0 ? '#00e5ff' : '#ffcc00'; gCtx.fill(); }
        }

        class Enemy {
            constructor() {
                if(Math.random() < 0.5) { this.x = Math.random() < 0.5 ? -30 : gameCanvas.width + 30; this.y = Math.random() * gameCanvas.height; }
                else { this.x = Math.random() * gameCanvas.width; this.y = Math.random() < 0.5 ? -30 : gameCanvas.height + 30; }
                this.radius = Math.random() * 20 + 15;
                const px = player ? player.x : gameCanvas.width/2;
                const py = player ? player.y : gameCanvas.height/2;
                const angle = Math.atan2(py - this.y, px - this.x);
                let baseSpeed = Math.random() * 2 + 2; 
                let scoreBonus = score / 800; 
                this.speed = Math.min(baseSpeed + Math.log(1 + scoreBonus), 8.5); 
                this.dx = Math.cos(angle); this.dy = Math.sin(angle);
                this.sides = Math.floor(Math.random() * 3 + 3); this.angle = 0; this.spin = (Math.random() - 0.5) * 0.1;
            }
            update() { this.x += this.dx * this.speed; this.y += this.dy * this.speed; this.angle += this.spin; }
            draw() {
                gCtx.save(); gCtx.translate(this.x, this.y); gCtx.rotate(this.angle);
                gCtx.beginPath(); gCtx.moveTo(this.radius, 0);
                for(let i=1; i<this.sides; i++) gCtx.lineTo(this.radius * Math.cos(i * 2 * Math.PI / this.sides), this.radius * Math.sin(i * 2 * Math.PI / this.sides));
                gCtx.closePath(); gCtx.strokeStyle = '#ff0055'; gCtx.lineWidth = 2; gCtx.stroke();
                gCtx.restore();
            }
        }

        class GameItem {
            constructor(type) {
                this.type = type;
                this.x = Math.random() * (gameCanvas.width - 100) + 50;
                this.y = Math.random() * (gameCanvas.height - 100) + 50;
                this.radius = 12; this.life = 420; this.pulse = 0; 
            }
            update() { this.life--; this.pulse += 0.1; }
            draw() {
                gCtx.save(); gCtx.translate(this.x, this.y);
                if(this.life < 120 && Math.floor(this.life / 10) % 2 === 0) gCtx.globalAlpha = 0.2; else gCtx.globalAlpha = 1;
                const s = 1 + Math.sin(this.pulse) * 0.2; gCtx.scale(s, s);
                gCtx.beginPath(); gCtx.arc(0, 0, this.radius, 0, Math.PI * 2);
                if(this.type === 'weapon') {
                    gCtx.fillStyle = '#00e5ff'; gCtx.fill(); gCtx.strokeStyle = '#fff'; gCtx.lineWidth = 2; gCtx.stroke();
                    gCtx.fillStyle = '#000'; gCtx.font = "bold 14px Arial"; gCtx.textAlign = "center"; gCtx.textBaseline = "middle"; gCtx.fillText("W", 0, 1);
                } else {
                    gCtx.fillStyle = '#00ff66'; gCtx.fill(); gCtx.strokeStyle = '#fff'; gCtx.lineWidth = 2; gCtx.stroke();
                    gCtx.fillStyle = '#000'; gCtx.font = "bold 16px Arial"; gCtx.textAlign = "center"; gCtx.textBaseline = "middle"; gCtx.fillText("+", 0, 2);
                }
                gCtx.restore();
            }
        }

        class GameParticle {
            constructor(x, y, color) {
                this.x = x; this.y = y; this.color = color;
                this.size = Math.random() * 3 + 1;
                this.speedX = (Math.random() * 4 - 2); this.speedY = (Math.random() * 4 - 2);
                this.life = 1;
            }
            update() { this.x += this.speedX; this.y += this.speedY; this.life -= 0.1; }
            draw() { gCtx.globalAlpha = this.life; gCtx.fillStyle = this.color; gCtx.beginPath(); gCtx.arc(this.x, this.y, this.size, 0, Math.PI*2); gCtx.fill(); gCtx.globalAlpha = 1; }
        }

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSound(freq, type, duration) {
            const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain();
            osc.type = type; osc.frequency.value = freq; osc.connect(gain); gain.connect(audioCtx.destination);
            osc.start(); gain.gain.exponentialRampToValueAtTime(0.00001, audioCtx.currentTime + duration);
            osc.stop(audioCtx.currentTime + duration);
        }

        function spawnEnemy() {
            const diff = score / 3000; 
            const chance = 0.03 + Math.min(diff, 0.09); 
            if(Math.random() < chance) enemies.push(new Enemy());
        }

        function updateHP(val) {
            if(val === 100) hp = 100;
            else hp += val;
            if(hp > 100) hp = 100; if(hp <= 0) hp = 0;
            hpDisplay.innerText = hp;
            const hEl = document.querySelector('.hud-health');
            if(hp <= 30) hEl.classList.add('low'); else hEl.classList.remove('low');
            if(val > 0) { hEl.style.color = 'var(--success)'; setTimeout(() => hEl.style.color = 'var(--accent)', 500); }
        }

        function showToast(el) { el.classList.add('active'); setTimeout(() => el.classList.remove('active'), 2000); }

        function gameAnimate() {
            if(!document.body.classList.contains('game-active')) return;
            if(!player) return;

            gameLoopId = requestAnimationFrame(gameAnimate);
            gCtx.clearRect(0, 0, gameCanvas.width, gameCanvas.height);

            gCtx.save();
            if(shakeTime > 0) {
                const s = 8; gCtx.translate((Math.random()*s)-(s/2), (Math.random()*s)-(s/2));
                shakeTime--;
            }

            if(activePowerUpTime > 0) activePowerUpTime--;

            if(isFiring && performance.now() - lastShotTime > FIRE_RATE) {
                player.shoot();
                lastShotTime = performance.now();
            }

            if(activePowerUpTime <= 0 && powerUps.length === 0 && Math.random() < 0.0008) powerUps.push(new GameItem('weapon'));
            if(healthItems.length === 0 && Math.random() < 0.001) healthItems.push(new GameItem('health')); 

            for(let i = powerUps.length - 1; i >= 0; i--) {
                const p = powerUps[i]; p.update(); p.draw();
                const dist = Math.hypot(player.x - p.x, player.y - p.y);
                if(dist < player.radius + p.radius) {
                    activePowerUpTime = 420; playSound(1200, 'sawtooth', 0.6); showToast(powerMsg); powerUps.splice(i, 1);
                } else if(p.life <= 0) powerUps.splice(i, 1);
            }

            for(let i = healthItems.length - 1; i >= 0; i--) {
                const h = healthItems[i]; h.update(); h.draw();
                const dist = Math.hypot(player.x - h.x, player.y - h.y);
                if(dist < player.radius + h.radius) {
                    updateHP(100); 
                    playSound(600, 'sine', 0.6); showToast(healMsg); healthItems.splice(i, 1);
                } else if(h.life <= 0) healthItems.splice(i, 1);
            }

            player.update(); player.draw();

            bullets.forEach((b, i) => { b.update(); b.draw(); if(b.marked) bullets.splice(i, 1); });
            gameParticles.forEach((p, i) => { p.update(); p.draw(); if(p.life <= 0) gameParticles.splice(i, 1); });

            spawnEnemy();
            enemies.forEach((e, i) => {
                e.update(); e.draw();
                bullets.forEach((b, j) => {
                    const dist = Math.hypot(b.x - e.x, b.y - e.y);
                    if(dist - e.radius - 3 < 1) {
                        for(let k=0; k<6; k++) gameParticles.push(new GameParticle(e.x, e.y, '#ff0055'));
                        score += 100; document.getElementById('score-val').innerText = score;
                        playSound(150, 'sawtooth', 0.1);
                        setTimeout(() => { if(enemies[i]) enemies.splice(i, 1); if(bullets[j]) bullets.splice(j, 1); }, 0);
                    }
                });
                const distP = Math.hypot(player.x - e.x, player.y - e.y);
                if(distP - e.radius - player.radius < 1) {
                     for(let k=0; k<10; k++) gameParticles.push(new GameParticle(player.x, player.y, '#ffcc00'));
                     updateHP(-20); enemies.splice(i, 1); playSound(100, 'sawtooth', 0.5);
                     shakeTime = 10; damageOverlay.style.boxShadow = 'inset 0 0 100px 50px rgba(255, 0, 85, 0.5)';
                     setTimeout(() => damageOverlay.style.boxShadow = 'inset 0 0 0 0 transparent', 200);
                     if(hp <= 0) gameOver();
                }
            });
            gCtx.restore();
        }

        function startGame() {
            document.body.classList.add('game-active');
            window.scrollTo(0,0); document.body.style.overflow = 'hidden';
            score = 0; hp = 100; activePowerUpTime = 0;
            powerUps = []; healthItems = []; bullets = []; enemies = []; gameParticles = [];
            document.getElementById('score-val').innerText = score;
            hpDisplay.innerText = "100";
            const hEl = document.querySelector('.hud-health'); hEl.classList.remove('low'); hEl.style.color = 'var(--accent)';
            player = new Player(); shakeTime = 0; isFiring = false;
            if(audioCtx.state === 'suspended') audioCtx.resume();
            gameAnimate();
        }

        function gameOver() { document.body.classList.add('game-over'); document.getElementById('final-score').innerText = score; cancelAnimationFrame(gameLoopId); }
        function resetGame() { document.body.classList.remove('game-over'); startGame(); }
        function exitGame() { document.body.classList.remove('game-active'); document.body.classList.remove('game-over'); document.body.style.overflow = 'auto'; cancelAnimationFrame(gameLoopId); }

        // --- BACKGROUND ---
        const bgCanvas = document.getElementById('particle-canvas'); const bgCtx = bgCanvas.getContext('2d');
        bgCanvas.width = window.innerWidth; bgCanvas.height = window.innerHeight;
        let bgParticles = [];
        class BgParticle {
            constructor() { this.x = Math.random() * bgCanvas.width; this.y = Math.random() * bgCanvas.height; this.size = Math.random() * 2 + 0.5; this.speedX = Math.random() * 1 - 0.5; this.speedY = Math.random() * 1 - 0.5; }
            update() { this.x += this.speedX; this.y += this.speedY; if(this.x > bgCanvas.width || this.x < 0) this.speedX *= -1; if(this.y > bgCanvas.height || this.y < 0) this.speedY *= -1; }
            draw() { bgCtx.fillStyle = 'rgba(255,255,255,0.2)'; bgCtx.beginPath(); bgCtx.arc(this.x, this.y, this.size, 0, Math.PI*2); bgCtx.fill(); }
        }
        function initBg() { bgParticles = []; for(let i=0; i<35; i++) bgParticles.push(new BgParticle()); }
        function animateBg() {
            bgCtx.clearRect(0,0, bgCanvas.width, bgCanvas.height);
            for(let i=0; i<bgParticles.length; i++) {
                bgParticles[i].update(); bgParticles[i].draw();
                for(let j=i; j<bgParticles.length; j++) {
                    const dx = bgParticles[i].x - bgParticles[j].x; const dy = bgParticles[i].y - bgParticles[j].y;
                    const dist = Math.sqrt(dx*dx + dy*dy);
                    if(dist < 150) { bgCtx.strokeStyle = `rgba(255,255,255,${0.1 - dist/1500})`; bgCtx.lineWidth = 0.5; bgCtx.beginPath(); bgCtx.moveTo(bgParticles[i].x, bgParticles[i].y); bgCtx.lineTo(bgParticles[j].x, bgParticles[j].y); bgCtx.stroke(); }
                }
            }
            requestAnimationFrame(animateBg);
        }
        initBg(); animateBg(); window.addEventListener('resize', () => { bgCanvas.width = window.innerWidth; bgCanvas.height = window.innerHeight; initBg(); });

        document.querySelectorAll('.project-card').forEach(c => {
            const img = c.querySelector('img');
            c.addEventListener('mouseenter', () => { if(c.dataset.gif) img.src = c.dataset.gif; });
            c.addEventListener('mouseleave', () => { if(c.dataset.static) img.src = c.dataset.static; });
        });
        const observer = new IntersectionObserver((entries) => { entries.forEach(e => { if(e.isIntersecting) e.target.classList.add('visible'); else e.target.classList.remove('visible'); }); }, { threshold: 0.15 });
        document.querySelectorAll('.fade-section').forEach(s => observer.observe(s));
    </script>
</body>
</html>